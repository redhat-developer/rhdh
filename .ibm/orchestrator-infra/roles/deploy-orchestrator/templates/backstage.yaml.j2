{% if milestone|int < 4 %}
apiVersion: rhdh.redhat.com/v1alpha2
{% elif milestone|int >= 4 %}
apiVersion: rhdh.redhat.com/v1alpha3
{% endif %}    
kind: Backstage
metadata:
  name: backstage
  namespace: {{ rhdh_ns }}
spec:
  application:
    appConfig:
      configMaps:
      - name: app-config-rhdh
      - name: app-config-rhdh-auth
      - name: app-config-rhdh-catalog
      mountPath: /opt/app-root/src
    dynamicPluginsConfigMapName: dynamic-plugins-rhdh
    extraEnvs:
      secrets:
      - name: backstage-backend-auth-secret
      envs:
      - name: NODE_TLS_REJECT_UNAUTHORIZED
        value: "0"
    replicas: 1
{% if orch_rbac_enabled|bool %}
    extraFiles:
      configMaps:
      - name: rhdh-config-rbac-policy
      mountPath: /opt/app-root/src
{% endif %}
  deployment:
    patch:
      spec:
        template:
          spec:
            initContainers:
            - env:
              - name: MAX_ENTRY_SIZE
                value: "30000000"
              name: install-dynamic-plugins